# Одноязычный и кросс-языковой поиск 
Этот readme содержит подробное описание аргументов скриптов. Готовые примеры запуска для каждого метода можно найти в [главном readme](https://github.com/rusnlp/hse_nis/blob/master/README.md)

## utils
* **arguments:** модуль для работы с аргументами

* **loaders:** модуль для загрузки моделей, словаря, проекции 

* **preprocessing:** модуль для продобработки тексов, основанный на [этом скрипте](https://github.com/akutuzov/webvectors/blob/master/preprocessing/rus_preprocessing_udpipe.py)

* **vectorization:** модуль для векторизации текстов 


## preprocess_corpus
Лемматизация корпуса и сохранение его в json

#### Аргументы:
* обязательные

| Аргумент | Тип | Описание |
| :-------- | :---: | :---------|
|texts_path | str | Папка, в которой лежат тексты
|udpipe_path | str | Путь к модели udpipe для обработки корпуса
|lemmatized_path | str | Путь к файлу json, в который будут сохраняться лемматизированные файлы. Если файл уже существует, он будет пополняться

* опциональные

| Аргумент | Тип | Default | Описание |
| :-------- | :---: | :-------: | :-------- |
| keep_pos | pseudo-boolean int | 1 | Возвращать ли леммы, помеченные pos-тегами
| keep_stops| pseudo-boolean int | 0 | Сохранять ли слова, получившие тег функциональной части речи
| keep_punct | pseudo-boolean int | 0 | Сохранять ли знаки препинания
| forced| pseudo-boolean int | 0 | Принудительно лемматизировать весь корпус заново



## create_mapping
Создание маппинга индексов в заголовки и обратно и сохранение его в json

#### Аргументы:
* обязательные

| Аргумент | Тип | Описание |
| :-------- | :---: | :---------|
|texts_path | str | Папка, в которой лежат тексты 
|lang | str | Язык, для которого разбираем; нужен для определения словаря в маппинге (ru/en)
|mapping_path | str | Файл маппинга заголовков в индексы и обратно в формате json

* опциональные

| Аргумент | Тип | Default | Описание |
| :-------- | :---: | :-------: | :-------- |
| forced | pseudo-boolean int | 0 | Принудительно пересоздать весь маппинг 


## learn_projection
#### Аргументы:
* обязательные

| Аргумент | Тип | Описание |
| :-------- | :---: | :---------|
|src_model_path | str | Путь к эмбеддингам исходного языка
|tar_model_path | str | Путь к эмбеддингам целевого языка
|bidict_path | str | Путь к двуязычному словарю, по которому будет строиться проекция
|proj_path | str | Путь, по которому будет сохранена проекция



## vectorization pipeline
Пайплайн для векторизации двух корпусов любой моделью и составления общей матрицы векторов и общего маппинга

#### Аргументы:
* обязательные

| Аргумент | Тип | Описание |
| :-------- | :---: | :---------|
| src_lemmatized_path | str | Путь к лемматизованным текстам на исходном языке в формате json
| tar_lemmatized_path | str | Путь к лемматизованным текстам на целевом языке в формате json
| method | str | Метод векторизации (model/translation/projection)
| mapping_path | str | Файл маппинга заголовков в индексы и обратно в формате json

* опциональные

| Аргумент | Тип | Default | Описание |
| :-------- | :---: | :-------: | :-------- |
| lang | str | cross| Язык, для которго разбираем; нужен для определения словаря в маппинге. "сross" - для кросс-языковой векторизации
| direction | str | | Направление перевода векторов при кросс-языковой векторизации (ru-en). Обязателен при lang = cross 
| src_embeddings_path | str | | Путь к модели векторизации для исходного языка. Обязателен при method = model, projection
| tar_embeddings_path | str | | Путь к модели векторизации для целевого языка. Обязателен при method = model (если lang = cross), translation, projection
| common_output_vectors_path | str | | Путь к pkl, в котором лежит объединённый векторизованный корпус. Обязателен при lang = cross 
| src_output_vectors_path | str | | Путь к pkl, в котором лежит уже векторизованный корпус на исходном языке
| tar_output_vectors_path | str | | Путь к pkl, в котором лежит уже векторизованный корпус на целевом языке
| bidict_path | str | | Путь к двуязычному словарю в формате txt. Обязателен при method = translation
| projection_path | str | | Путь к матрице трансформации в формате txt. Обязателен при method = projection
| no_duplicates | pseudo-boolean int | 0 | Брать ли для каждого типа в тексте вектор только по одному разу
| forced | pseudo-boolean int | 0 | Принудительно векторизовать весь корпус заново


## monocorp_search
Ранжирование статей на основе косинусной близости векторов

##### Аргументы:
* обязательные

| Аргумент | Тип | Описание |
| :-------- | :---: | :---------|
| target_article_path | str | Путь к статье, для которой ищем ближайшие. Если статья из корпуса, то только название
| lang | str  | Язык, для которго разбираем; нужен для определения словаря в маппинге. "сross" - для кросс-языкового поиска
| mapping_path | str | Файл маппинга заголовков в индексы и обратно в формате json
| corpus_vectors_path | str | Путь к файлу pkl, в котором лежит векторизованный корпус

* опциональные

| Аргумент | Тип | Default | Описание |
| :-------- | :---: | :-------: | :-------- |
|top | int | 1 | Сколько близких статeй возвращать (-1 for all)
|verbose | pseudo-boolean int | 0 | Принтить ли рейтинг
|with_url | pseudo-boolean int | 0 | Добавлять ссылки к заголовкам
|url_mapping_path | str | | Путь к файлу маппинга заголовков в ссылки

* для внешних текстов

| Аргумент | Тип | Default | Описание |
| :-------- | :---: | :-------: | :-------- |
| included | pseudo-boolean int | 1 | Включена ли статья в корпус
| udpipe_path | str | | Папка, в которой лежит модель udpipe для обработки нового текста. Обязателен при included=1
| keep_pos | pseudo-boolean int | 1 | Возвращать ли леммы, помеченные pos-тегами
| keep_stops | pseudo-boolean int | 0 | Сохранять ли слова, получившие тег функциональной части речи
| keep_punct | pseudo-boolean int | 0 | Сохранять ли знаки препинания 
| method | str | | Метод векторизации (model/translation/projection). Обязателен при included=1
| embeddings_path | str | | Папка, в которой лежит модель для векторизации корпуса. Обязателен при included=1
| bidict_path | str | | Путь к двуязычному словарю в формате txt. Обязателен при method = translation
| projection_path | str | | Путь к матрице трансформации в формате txt. Обязателен при method = projection
| no_duplicates | pseudo-boolean int | 0 | Брать ли для каждого типа в тексте вектор только по одному разу



## evaluate_corpus
Оценка качества поиска: проверка среди 1, 5, 10 ближайших

#### Аргументы:

* обязательные

| Аргумент | Тип | Описание |
| :-------- | :---: | :---------|
| lang | str | Язык, для которого разбираем; нужен для определения словаря в маппинге. "сross" - для кросс-языкового поиска
| mapping_path | str | Файл маппинга заголовков в индексы и обратно в формате json
| corpus_vectors_path | str | Путь к файлу pkl, в котором лежит векторизованный корпус
| golden_standard_path | str | Файл с парами наиболее близких статей

* опциональные

| Аргумент | Тип | Default | Описание |
| :-------- | :---: | :-------: | :-------- |
|top_ns | str | 1, 5, 10 | Среди скольки ближайших искать совпадение (перечисление чисел через запятую без пробела)


## automatic_search
Поочерёдный поиск ближайших статей к заданным и сохраенние результатов

#### Аргументы:
* обязательные

| Аргумент | Тип | Описание |
| :-------- | :---: | :---------|
| titles_path | str | Список заголовков, для которых запускаем поиск
| mapping_path | str | Файл маппинга заголовков в индексы и обратно в формате json
| corpus_vectors_path | str | Путь к файлу pkl, в котором лежит векторизованный корпус
| result_path | str | Файл, куда сохранятся результаты поиска

* опциональные

| Аргумент | Тип | Default | Описание |
| :-------- | :---: | :-------: | :-------- |
|lang | str | cross | Язык, для которого разбираем; нужен для определения словаря в маппинге. "сross" - для кросс-языкового поиска
|top | str | 1 | Сколько близких статeй возвращать (-1 for all)
|with_url | pseudo-boolean int | 0 | Добавлять ссылки к заголовкам
|url_mapping_path | str | | Путь к файлу маппинга заголовков в ссылки


## translate_corpus
Перевод корпуса по двуязычному словарю и сохранение файлов, а также создание словаря лемматизированных текстов

#### Аргументы:
* обязательные

| Аргумент | Тип | Описание |
| :-------- | :---: | :---------|
| src_texts_path | str | Папка, в которой лежат тексты
| translated_texts_path | str | Папка, в которой будут сохранятся переведённые тексты
| udpipe_path | str | Путь к модели udpipe для обработки корпуса
| bidict_path | str | Путь к файлу txt, содержащему пары слово-перевод

* опциональные

| Аргумент | Тип | Default | Описание |
| :-------- | :---: | :-------: | :-------- |
| keep_pos | pseudo-boolean int | 1 | Возвращать ли леммы, помеченные pos-тегами
| keep_stops | pseudo-boolean int | 0 | Сохранять ли слова, получившие тег функциональной части речи
| keep_punct | pseudo-boolean int | 0 | Сохранять ли знаки препинания 
| lemmatized_path | str |  | Путь, куда сохранится json с лемматизированными текстами





